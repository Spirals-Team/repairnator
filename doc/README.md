# Documentation of Repairnator

This directory provides the official documentation about the Repairnator project.

## Overview

Repairnator is  a bot to automatically repair failing builds coming from Travis CI. By repairing we mean proposing patches that make the entire test-suite passing on a given build.

A sub project, called BEARS, aimed at creating a database of bugs by mining bugs and patches on Travis CI and GitHub, see [Bears: An Extensible Java Bug Benchmark for Automatic Program Repair Studies](https://arxiv.org/pdf/1901.06024).

## Content of the repository

This repository is organized as follows:

  * [doc](../doc) contains the reference documentation about Repairnator and its usage;
  * [repairnator](../repairnator) is the main program dedicated to this project: it can automatically scan large set of projects, detect failing builds, reproduce them and try to repair them using our tools;
  * [resources](../resources) contains mainly data produced by Repairnator, scripts to retrieve those data, and it also contains the schema of repairnator.json files;
  * [website](../website) contains all data to produce repairnator website.

## Terminology

We use in Repairnator a lot of different IDs or names to identify things.
So here a little bit of terminology to help the reader:
 - *build ID*: it's a Travis CI ID for the build of a repository. If you see an URL like this one: https://travis-ci.org/surli/failingProject/builds/413285802, then the build ID is `413285802`.
 - *Run ID*: it's a UUID generated by our own scripts using `uuid` UNIX tool to distinguish different Repairnator runs;
 - *Repository name (or slug)*: unless it's specified if we talk about a repository name, it's the GitHub *slug*: for repairnator it's `eclipse/repairnator`;
 - *Travis/GitHub Repository ID*: we might sometimes use specific IDs from third-party API like the Travis CI Repository ID we use to blacklist some repository: we explicit the tool in those cases, 
 but not that you may need to interrogate the third-party APIs to retrieve those IDs.

## Contributing

Contribution on Repairnator are more than welcome!
A first way to contribute is to look on the label [good-first-issue](https://github.com/eclipse/repairnator/labels/good-first-issue).

## Running Repairnator

### Fixing a build

To fix a specific Travis CI build:

```
docker run -e BUILD_ID=564711868 -e GITHUB_OAUTH=<GITHUB TOKEN> repairnator/pipeline
```

It is possible to create your own GitHub token from [this page](https://github.com/settings/tokens), by selecting `public_repo` referring to the scope that has to be associated with the token.

You can also specify the values associated with these parameters: [REPAIR_TOOLS](https://github.com/eclipse/repairnator/blob/a78745d1f6c0cf4d356cfc20485030fc0f18eb79/doc/repairnator-config.md#repair_tools), [MONGODB_HOST](https://github.com/eclipse/repairnator/blob/a78745d1f6c0cf4d356cfc20485030fc0f18eb79/doc/repairnator-config.md#mongodb_host), [MONGODB_NAME](https://github.com/eclipse/repairnator/blob/a78745d1f6c0cf4d356cfc20485030fc0f18eb79/doc/repairnator-config.md#mongodb_name), [PUSH_URL](https://github.com/eclipse/repairnator/blob/a78745d1f6c0cf4d356cfc20485030fc0f18eb79/doc/repairnator-config.md#push_url), [SMTP_SERVER](https://github.com/eclipse/repairnator/blob/a78745d1f6c0cf4d356cfc20485030fc0f18eb79/doc/repairnator-config.md#smtp_server), [NOTIFY_TO](https://github.com/eclipse/repairnator/blob/a78745d1f6c0cf4d356cfc20485030fc0f18eb79/doc/repairnator-config.md#notify_to), [GITHUB_USERNAME](https://github.com/eclipse/repairnator/blob/a78745d1f6c0cf4d356cfc20485030fc0f18eb79/doc/repairnator-config.md#github_username), [GITHUB_USEREMAIL](https://github.com/eclipse/repairnator/blob/a78745d1f6c0cf4d356cfc20485030fc0f18eb79/doc/repairnator-config.md#github_useremail), and [CREATE_PR](https://github.com/eclipse/repairnator/blob/a78745d1f6c0cf4d356cfc20485030fc0f18eb79/doc/repairnator-config.md#create_pr). Before every parameter name, it is necessary to put the key `-e`, as in the above example.

### Running the real-time scanner

Prerequisites: Java, Docker

```
git clone https://github.com/eclipse/repairnator/
cd repairnator/src/scripts/
# doc at https://github.com/eclipse/repairnator/blob/master/doc/scripts.md#launch_rtscannersh
bash launch_rtscanner.sh
```

### Scripts

The documentation about the scripts is [available here](scripts.md). More details about the Repairnator configuration file can be found [here](repairnator-config.md).

## Integration

* [Jenkins integration](https://github.com/eclipse/repairnator/blob/master/doc/repairnator-jenkins-plugin.md)
* [Github app integration](https://github.com/eclipse/repairnator/blob/master/doc/repairnator-github-app.md)
* [Deployment in Kubernetes](https://github.com/eclipse/repairnator/blob/master/doc/repairnator-kubernetes.md)

## Program repair tools used in Repairnator
 
For more information about the program repair tools and their strategies implemented in Repairnator, [take a look at this page](repair-tools.md).

To add a new program repair tool in Repairnator, [here is the guide](contributing/add-repair-tool.md).

## Architecture

### The pipeline

The pipeline takes as input a Travis CI build ID and tries to replicate the bug and to repair it with different repair tools. It provides a single abstraction over repair tools. As its name indicates, it's a pipeline of steps, from cloning the repository and building it, to launching the repair tools and pushing a resulting branch. It contains plenty of options, for notifying the users, creating a pull requests, etc.

The pipeline be used:
* directly in Java
* or as a Docker image: it encapsulates the pipeline in an environment in which it will properly work, with the right dependencies, in a sandboxed environment.

### The scanner

The `RTScanner` is a daemon that constantly inspects Travis CI for catching newly failing builds to launch as fast as possible. When failing builds are found, a pipeline is run per build. `FastScanner` is a different implementation of the same idea.


### Java main classes

This [page](main-classes.md) documents the main classes of Repairnator.

### Chores

As part of using Repairnator, you might need to do some chores, like managing a MongoDB database.
We provided some documentation [about backups](chore/managedb.md) and [about MongoDB collection schema](chore/mongo).

## Academic bibliographic references

"[Repairnator patches programs automatically](https://ubiquity.acm.org/article.cfm?id=3349589)", In Ubiquity, Association for Computing Machinery, vol. July, no. 2, pp. 1-12, 2019. 

```
@article{monperrus:hal-02267512,
 title = {Repairnator patches programs automatically},
 author = {Monperrus, Martin and Urli, Simon and Durieux, Thomas and Martinez, Martin and Baudry, Benoit and Seinturier, Lionel},
 url = {https://hal.inria.fr/hal-02267512/file/repairnator.pdf},
 journal = {{Ubiquity}},
 publisher = {{Association for Computing Machinery}},
 volume = {July},
 number = {2},
 pages = {1-12},
 year = {2019},
 doi = {10.1145/3349589},
}
```

"[How to Design a Program Repair Bot? Insights from the Repairnator Project](https://hal.inria.fr/hal-01691496/file/SEIP_63_Camera-Ready-no-copyright.pdf)", In 40th International Conference on Software Engineering, Track Software Engineering in Practice, pp. 95-104, 2018. 

```
@inproceedings{urli:hal-01691496,
 title = {How to Design a Program Repair Bot? Insights from the Repairnator Project},
 author = {Urli, Simon and Yu, Zhongxing and Seinturier, Lionel and Monperrus, Martin},
 url = {https://hal.inria.fr/hal-01691496/file/SEIP_63_Camera-Ready-no-copyright.pdf},
 booktitle = {{40th International Conference on Software Engineering, Track Software Engineering in Practice}},
 pages = {95-104},
 year = {2018},
 doi = {10.1145/3183519.3183540},
}

```

