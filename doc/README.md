# Documentation of Repairnator

This directory provides a general documentation about Repairnator project.

## Overview

Repairnator is  a bot to automatically repair failing builds coming from Travis CI. By repairing we mean proposing patches that make the entire test-suite passing on a given build.

A sub project, called BEARS, aimed at creating a database of bugs by mining bugs and patches on Travis CI and GitHub, see [Bears: An Extensible Java Bug Benchmark for Automatic Program Repair Studies](https://arxiv.org/pdf/1901.06024).

## Content of the repository

This repository is organized as follows:

  * [doc](../doc) contains the reference documentation about Repairnator and its usage;
  * [repairnator](../repairnator) is the main program dedicated to this project: it can automatically scan large set of projects, detect failing builds, reproduce them and try to repair them using our tools;
  * [resources](../resources) contains mainly data produced by Repairnator, scripts to retrieve those data, and it also contains the schema of repairnator.json files;
  * [website](../website) contains all data to produce repairnator website.

## Terminology

We use in Repairnator a lot of different IDs or names to identify things.
So here a little bit of terminology to help the reader:
 - *build ID*: it's a Travis CI ID for the build of a repository. If you see an URL like this one: https://travis-ci.org/surli/failingProject/builds/413285802, then the build ID is `413285802`.
 - *Run ID*: it's a UUID generated by our own scripts using `uuid` UNIX tool to distinguish different Repairnator runs;
 - *Repository name (or slug)*: unless it's specified if we talk about a repository name, it's the GitHub *slug*: for repairnator it's `eclipse/repairnator`;
 - *Travis/GitHub Repository ID*: we might sometimes use specific IDs from third-party API like the Travis CI Repository ID we use to blacklist some repository: we explicit the tool in those cases, 
 but not that you may need to interrogate the third-party APIs to retrieve those IDs.

## Contributing

Contribution on Repairnator are more than welcome!
A first way to contribute is to look on the label [good-first-issue](https://github.com/eclipse/repairnator/labels/good-first-issue).

## Running Repairnator

### Fixing a build

To fix a specific Travis CI build:

```
docker run -e BUILD_ID=564711868 -e GITHUB_OAUTH=<GITHUB TOKEN> repairnator/pipeline
```

It is possible to create your own GitHub token from [this page](https://github.com/settings/tokens), by selecting `public_repo` referring to the scope that has to be associated with the token.

### Running the real-time scanner

Prerequisites: Java, Docker

```
git clone https://github.com/eclipse/repairnator/
cd repairnator/repairnator/scripts/
# doc at https://github.com/eclipse/repairnator/blob/master/doc/scripts.md#launch_rtscannersh
bash launch_rtscanner.sh
```

### Scripts

The documentation about the scripts is [available here](scripts.md). More details about the Repairnator configuration file can be found [here](repairnator-config.md).

## Chores

As part of using Repairnator, you might need to do some chores, like managing a MongoDB database.
We provided some documentation [about backups](chore/managedb.md) and [about MongoDB collection schema](chore/mongo).

## Program repair tools used in Repairnator

The list of program repair tools currently supported in Repairnator is as follows:
  - Nopol;
  - NPEFix;
  - Astor;
  - AssertFixer.
  
For more information about the program repair tools and their strategies implemented in Repairnator, [take a look at this page](repair-tools.md).

**Adding a new tool:** to add a new program repair tool in Repairnator, [here is the guide](contributing/add-repair-tool.md).

## Architecture

### The pipeline

The pipeline is the most interesting part of Repairnator: it takes as input a Travis CI build ID and tries to replicate the bug and to repair it.
As its name indicates, it's a pipeline of steps, from cloning the repository and building it, to launching the repair tools and pushing a resulting branch.
It contains plenty of options, for notifying the users, creating a pull requests, etc.

### The realtime scanner

The RTScanner is the newest part of Repairnator: the idea is to have a daemon that constantly inspects Travis CI for newly failing builds to launch as fast as possible the pipeline to fix them.
The RTScanner then uses some elements from the dockerpool to operate itself the pipeline through its Docker image.

### The Docker image

The Docker image is the pipeline put in Docker: the idea is to encapsulate the pipeline in an environment in which it will properly work, with the right dependencies, and to be able to use the pipeline in sandboxed environment.

### Java main classes

This [page](main-classes.md) documents the main classes of Repairnator.
